k <- min(ncol(B_bvr), ncol(B_ols), ncol(B_svr))
B_bvr <- B_bvr[, 1:k, drop=FALSE]
B_ols <- B_ols[, 1:k, drop=FALSE]
B_svr <- B_svr[, 1:k, drop=FALSE]
}
## 6) long 포맷으로 변환
beta_long <- bind_rows(
as_tibble(as.data.frame(as.table(B_bvr))) %>% mutate(method="BVR"),
as_tibble(as.data.frame(as.table(B_ols))) %>% mutate(method="OLS"),
as_tibble(as.data.frame(as.table(B_svr))) %>% mutate(method="SVR")
) %>%
rename(treated = Var1, control = Var2, beta = Freq) %>%
mutate(method = factor(method, levels=c("BVR","OLS","SVR")))
## 7) Figure 4: control 3개 골라 facet으로 (논문 스타일)
# set.seed(1)
# controls_show <- sample(unique(beta_long$control), 8)
p_fig4 <- beta_long %>%
ggplot(aes(x = treated, y = beta, color = method, group = method)) +
geom_line(linewidth = 1.1) +
facet_wrap(~ control, nrow = 2) +
scale_color_manual(values = COL, name = "Method") +
# ✅ x축을 1~5로 간소화
scale_x_discrete(
breaks = treated_names,
labels = as.character(seq_along(treated_names))
) +
labs(x = "Treated units", y = expression(beta[c])) +
theme_bw(base_size = 18) +
theme(
legend.position = "top",
panel.grid.minor = element_blank()
)
p_fig4
ggsave("models_2013.png", p_fig4, width = 13, dpi = 500)
## 1) sim에서 treated/control 이름 및 treated 수 잡기
# rownames가 "Y1999" 같은 형태면 연도 추출 (여기선 그림엔 직접 쓰진 않지만 같이 둠)
years <- as.integer(gsub("^[A-Za-z]+", "", rownames(res$sim)))
treated_names <- grep("Treated", colnames(res$sim), value = TRUE)
control_names <- setdiff(colnames(res$sim), treated_names)
n_treated <- length(treated_names)
n_control <- length(control_names)
stopifnot(n_treated > 0, n_control > 0)
## 색(논문 느낌)
COL <- c(BVR="#F0E442", OLS="#56B4E9", SVR="#009E73")
## 2) BVR: treated 1..K의 gp1(draw x Kcol)에서 beta 매트릭스 만들기
get_bvr_beta_matrix_from_gp1 <- function(res, n_treated, treated_names, control_names = NULL) {
BVR <- res$est$BVR
# "treated 1", "treated 2" 처럼 공백 허용
treated_slots <- grep("^treated\\s*[0-9]+$", names(BVR), value = TRUE)
if (length(treated_slots) == 0) stop("BVR에서 'treated 1' 형태 키를 못 찾음.")
# 숫자 기준 정렬
ord <- order(as.integer(gsub("^treated\\s*", "", treated_slots)))
treated_slots <- treated_slots[ord]
# 첫 treated의 gp1로 열 수 확인
gp1_1 <- as.matrix(BVR[[treated_slots[1]]]$gp1)  # draws x K
K <- ncol(gp1_1)
# (a) intercept 후보 열: 이름으로 찾기
drop_idx <- integer(0)
if (!is.null(colnames(gp1_1))) {
drop_idx <- which(tolower(colnames(gp1_1)) %in% c("(intercept)","intercept","beta0","const"))
}
# (b) 이름이 없는데 K = control+1 이면 "첫 열 intercept" 가정(가장 흔함)
if (length(drop_idx) == 0 && !is.null(control_names) && K == length(control_names) + 1) {
drop_idx <- 1
}
# 실제 사용할 K2
gp1_1_use <- gp1_1
if (length(drop_idx) > 0) gp1_1_use <- gp1_1[, -drop_idx, drop=FALSE]
K2 <- ncol(gp1_1_use)
# treated x control(beta) 조립: control별 posterior median
T_use <- min(n_treated, length(treated_slots))
B <- matrix(NA_real_, nrow = T_use, ncol = K2)
for (t in seq_len(T_use)) {
gp1 <- as.matrix(BVR[[treated_slots[t]]]$gp1)  # draws x K
if (length(drop_idx) > 0) gp1 <- gp1[, -drop_idx, drop=FALSE]  # draws x K2
B[t, ] <- apply(gp1, 2, median)
}
# row/col 이름
rownames(B) <- treated_names[seq_len(nrow(B))]
# colnames: gp1에 있으면 그걸 우선, 없으면 control_names 또는 C1..Cn
if (!is.null(colnames(gp1_1_use))) {
colnames(B) <- colnames(gp1_1_use)
} else if (!is.null(control_names) && length(control_names) == ncol(B)) {
colnames(B) <- control_names
} else {
colnames(B) <- paste0("C", seq_len(ncol(B)))
}
B
}
B_bvr <- get_bvr_beta_matrix_from_gp1(res, n_treated, treated_names, control_names)
## 3) OLS: 16x5(control x treated) -> 5x16(treated x control)
B_ols_raw <- as.matrix(res$est$OLS)
# 안전하게 전치 (너 케이스에서 dim=16x5)
B_ols <- t(B_ols_raw)
# 이름 붙이기(가능하면)
rownames(B_ols) <- treated_names[seq_len(nrow(B_ols))]
colnames(B_ols) <- control_names[seq_len(ncol(B_ols))]
## 4) SVR(SMAC): draw x treated x control -> posterior median (treated x control)
beta_draws <- res$est$SMAC$beta
# 기대: [draw, treated, control]
stopifnot(length(dim(beta_draws)) == 3)
stopifnot(dim(beta_draws)[2] == n_treated)
B_svr <- apply(beta_draws, c(2,3), median)
rownames(B_svr) <- treated_names
# SMAC의 control 이름이 없다면 sim의 control_names를 붙임(길이 맞을 때만)
if (is.null(colnames(B_svr)) && length(control_names) == ncol(B_svr)) {
colnames(B_svr) <- control_names
}
## 5) 세 방법의 control 차원을 일치시키기
# 보통 BVR gp1이 17열인데 intercept 제거되면 16열로 맞아야 정상.
# 그래도 이름이 안 맞거나 개수가 다르면 "공통 control"만 취함.
if (!is.null(colnames(B_bvr)) && !is.null(colnames(B_ols)) && !is.null(colnames(B_svr))) {
common_controls <- Reduce(intersect, list(colnames(B_bvr), colnames(B_ols), colnames(B_svr)))
if (length(common_controls) == 0) stop("세 방법의 control colnames 교집합이 0. colnames 확인 필요.")
B_bvr <- B_bvr[, common_controls, drop=FALSE]
B_ols <- B_ols[, common_controls, drop=FALSE]
B_svr <- B_svr[, common_controls, drop=FALSE]
} else {
k <- min(ncol(B_bvr), ncol(B_ols), ncol(B_svr))
B_bvr <- B_bvr[, 1:k, drop=FALSE]
B_ols <- B_ols[, 1:k, drop=FALSE]
B_svr <- B_svr[, 1:k, drop=FALSE]
}
## 6) long 포맷으로 변환
beta_long <- bind_rows(
as_tibble(as.data.frame(as.table(B_bvr))) %>% mutate(method="BVR"),
as_tibble(as.data.frame(as.table(B_ols))) %>% mutate(method="OLS"),
as_tibble(as.data.frame(as.table(B_svr))) %>% mutate(method="SVR")
) %>%
rename(treated = Var1, control = Var2, beta = Freq) %>%
mutate(method = factor(method, levels=c("BVR","OLS","SVR")))
## 7) Figure 4: control 3개 골라 facet으로 (논문 스타일)
# set.seed(1)
# controls_show <- sample(unique(beta_long$control), 8)
p_fig4 <- beta_long %>%
ggplot(aes(x = treated, y = beta, color = method, group = method)) +
geom_line(linewidth = 1.1) +
facet_wrap(~ control, nrow = 2) +
scale_color_manual(values = COL, name = "Method") +
# ✅ x축을 1~5로 간소화
scale_x_discrete(
breaks = treated_names,
labels = as.character(seq_along(treated_names))
) +
labs(x = "Treated units", y = expression(beta[c])) +
theme_bw(base_size = 14) +
theme(
legend.position = "top",
panel.grid.minor = element_blank()
)
p_fig4
ggsave("models_2013.png", p_fig4, width = 13, dpi = 500)
## 1) sim에서 treated/control 이름 및 treated 수 잡기
# rownames가 "Y1999" 같은 형태면 연도 추출 (여기선 그림엔 직접 쓰진 않지만 같이 둠)
years <- as.integer(gsub("^[A-Za-z]+", "", rownames(res$sim)))
treated_names <- grep("Treated", colnames(res$sim), value = TRUE)
control_names <- setdiff(colnames(res$sim), treated_names)
n_treated <- length(treated_names)
n_control <- length(control_names)
stopifnot(n_treated > 0, n_control > 0)
## 색(논문 느낌)
COL <- c(BVR="#F0E442", OLS="#56B4E9", SVR="#009E73")
## 2) BVR: treated 1..K의 gp1(draw x Kcol)에서 beta 매트릭스 만들기
get_bvr_beta_matrix_from_gp1 <- function(res, n_treated, treated_names, control_names = NULL) {
BVR <- res$est$BVR
# "treated 1", "treated 2" 처럼 공백 허용
treated_slots <- grep("^treated\\s*[0-9]+$", names(BVR), value = TRUE)
if (length(treated_slots) == 0) stop("BVR에서 'treated 1' 형태 키를 못 찾음.")
# 숫자 기준 정렬
ord <- order(as.integer(gsub("^treated\\s*", "", treated_slots)))
treated_slots <- treated_slots[ord]
# 첫 treated의 gp1로 열 수 확인
gp1_1 <- as.matrix(BVR[[treated_slots[1]]]$gp1)  # draws x K
K <- ncol(gp1_1)
# (a) intercept 후보 열: 이름으로 찾기
drop_idx <- integer(0)
if (!is.null(colnames(gp1_1))) {
drop_idx <- which(tolower(colnames(gp1_1)) %in% c("(intercept)","intercept","beta0","const"))
}
# (b) 이름이 없는데 K = control+1 이면 "첫 열 intercept" 가정(가장 흔함)
if (length(drop_idx) == 0 && !is.null(control_names) && K == length(control_names) + 1) {
drop_idx <- 1
}
# 실제 사용할 K2
gp1_1_use <- gp1_1
if (length(drop_idx) > 0) gp1_1_use <- gp1_1[, -drop_idx, drop=FALSE]
K2 <- ncol(gp1_1_use)
# treated x control(beta) 조립: control별 posterior median
T_use <- min(n_treated, length(treated_slots))
B <- matrix(NA_real_, nrow = T_use, ncol = K2)
for (t in seq_len(T_use)) {
gp1 <- as.matrix(BVR[[treated_slots[t]]]$gp1)  # draws x K
if (length(drop_idx) > 0) gp1 <- gp1[, -drop_idx, drop=FALSE]  # draws x K2
B[t, ] <- apply(gp1, 2, median)
}
# row/col 이름
rownames(B) <- treated_names[seq_len(nrow(B))]
# colnames: gp1에 있으면 그걸 우선, 없으면 control_names 또는 C1..Cn
if (!is.null(colnames(gp1_1_use))) {
colnames(B) <- colnames(gp1_1_use)
} else if (!is.null(control_names) && length(control_names) == ncol(B)) {
colnames(B) <- control_names
} else {
colnames(B) <- paste0("C", seq_len(ncol(B)))
}
B
}
B_bvr <- get_bvr_beta_matrix_from_gp1(res, n_treated, treated_names, control_names)
## 3) OLS: 16x5(control x treated) -> 5x16(treated x control)
B_ols_raw <- as.matrix(res$est$OLS)
# 안전하게 전치 (너 케이스에서 dim=16x5)
B_ols <- t(B_ols_raw)
# 이름 붙이기(가능하면)
rownames(B_ols) <- treated_names[seq_len(nrow(B_ols))]
colnames(B_ols) <- control_names[seq_len(ncol(B_ols))]
## 4) SVR(SMAC): draw x treated x control -> posterior median (treated x control)
beta_draws <- res$est$SMAC$beta
# 기대: [draw, treated, control]
stopifnot(length(dim(beta_draws)) == 3)
stopifnot(dim(beta_draws)[2] == n_treated)
B_svr <- apply(beta_draws, c(2,3), median)
rownames(B_svr) <- treated_names
# SMAC의 control 이름이 없다면 sim의 control_names를 붙임(길이 맞을 때만)
if (is.null(colnames(B_svr)) && length(control_names) == ncol(B_svr)) {
colnames(B_svr) <- control_names
}
## 5) 세 방법의 control 차원을 일치시키기
# 보통 BVR gp1이 17열인데 intercept 제거되면 16열로 맞아야 정상.
# 그래도 이름이 안 맞거나 개수가 다르면 "공통 control"만 취함.
if (!is.null(colnames(B_bvr)) && !is.null(colnames(B_ols)) && !is.null(colnames(B_svr))) {
common_controls <- Reduce(intersect, list(colnames(B_bvr), colnames(B_ols), colnames(B_svr)))
if (length(common_controls) == 0) stop("세 방법의 control colnames 교집합이 0. colnames 확인 필요.")
B_bvr <- B_bvr[, common_controls, drop=FALSE]
B_ols <- B_ols[, common_controls, drop=FALSE]
B_svr <- B_svr[, common_controls, drop=FALSE]
} else {
k <- min(ncol(B_bvr), ncol(B_ols), ncol(B_svr))
B_bvr <- B_bvr[, 1:k, drop=FALSE]
B_ols <- B_ols[, 1:k, drop=FALSE]
B_svr <- B_svr[, 1:k, drop=FALSE]
}
## 6) long 포맷으로 변환
beta_long <- bind_rows(
as_tibble(as.data.frame(as.table(B_bvr))) %>% mutate(method="BVR"),
as_tibble(as.data.frame(as.table(B_ols))) %>% mutate(method="OLS"),
as_tibble(as.data.frame(as.table(B_svr))) %>% mutate(method="SVR")
) %>%
rename(treated = Var1, control = Var2, beta = Freq) %>%
mutate(method = factor(method, levels=c("BVR","OLS","SVR")))
## 7) Figure 4: control 3개 골라 facet으로 (논문 스타일)
# set.seed(1)
# controls_show <- sample(unique(beta_long$control), 8)
p_fig4 <- beta_long %>%
ggplot(aes(x = treated, y = beta, color = method, group = method)) +
geom_line(linewidth = 1.1) +
facet_wrap(~ control, nrow = 2) +
scale_color_manual(values = COL, name = "Method") +
# ✅ x축을 1~5로 간소화
scale_x_discrete(
breaks = treated_names,
labels = as.character(seq_along(treated_names))
) +
labs(x = "Treated units", y = expression(beta[c])) +
theme_bw(base_size = 14) +
theme(
legend.position = "top",
panel.grid.minor = element_blank()
)
p_fig4
ggsave("models_2013.png", p_fig4, width = 13, height = 6, dpi = 500)
res[["ci"]][["OLS"]][["lower_bound"]]
res[["ci"]][["OLS"]][["lower_bound"]]
res[["ci"]][["OLS"]]
res[["ci"]][["SMAC"]]
res[["ci"]][["BVR"]]
avg_ci_width <- function(res, method) {
stopifnot(!is.null(res$ci[[method]]))
lb <- as.matrix(res$ci[[method]]$lower_bound)
ub <- as.matrix(res$ci[[method]]$upper_bound)
mean(ub - lb, na.rm = TRUE)   # 28*5 전부 평균
}
# 사용: 방법 이름이 정확히 "OLS","BVR","SMAC"인 경우
out <- data.frame(
method = c("OLS", "BVR", "SMAC"),
mean_ci_width = c(
avg_ci_width(res, "OLS"),
avg_ci_width(res, "BVR"),
avg_ci_width(res, "SMAC")
)
)
out
# install.packages(c("fixest","dplyr","ggplot2"))
library(dplyr)
library(ggplot2)
library(fixest)
TREAT_YEAR <- 2013
# ------------------------------------------------------------
# A) DiD용 패널 만들기
#   - ts_df에: year, outcome, unit_id, type, radius_km 가 있다고 가정
# ------------------------------------------------------------
did_df <- ts_df %>%
mutate(
band = case_when(
type == "Treated Unit" ~ "Treated_Core",
type == "Treated Spillover" ~ paste0("Treated_Band_", radius_km, "km"),
TRUE ~ "Control"
),
rel_time = year - TREAT_YEAR,
post = as.integer(year >= TREAT_YEAR),
# 밴드 더미(컨트롤은 전부 0)
core = as.integer(band == "Treated_Core"),
b5   = as.integer(band == "Treated_Band_5km"),
b10  = as.integer(band == "Treated_Band_10km"),
b15  = as.integer(band == "Treated_Band_15km"),
b20  = as.integer(band == "Treated_Band_20km")
) %>%
# 필요하면 control 오염 우려되는 애들 더 제외(너의 excluded 로직이 있으면 여기에 적용)
filter(!is.na(outcome)) %>%
mutate(unit_id = factor(unit_id))
View(te_df)
View(sim)
write(sim, "sim.csv", row.names = FALSE)
write.csv(sim, "sim.csv", row.names = FALSE)
write.csv(sim, "sim.csv", row.names = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(fixest)
library(broom)
# ------------------------------------------------------------
# 0) sim 불러오기
# ------------------------------------------------------------
sim_df <- read.csv("sim.csv", check.names = FALSE)
rownames(sim_df) <- sim_df[[1]]
sim_df[[1]] <- NULL
years <- as.integer(sub("^Y", "", rownames(sim_df)))
# treated 5개(컬럼명 고정)
treated_cols <- c("Treated_Core",
"Treated_Band_5km", "Treated_Band_10km",
"Treated_Band_15km", "Treated_Band_20km")
stopifnot(all(treated_cols %in% colnames(sim_df)))
TREAT_YEAR <- 2013
# ------------------------------------------------------------
# 1) long panel 만들기
# ------------------------------------------------------------
did_df <- sim_df %>%
mutate(year = years) %>%
pivot_longer(-year, names_to = "unit_id", values_to = "outcome") %>%
mutate(
rel_time = year - TREAT_YEAR,
core = as.integer(unit_id == "Treated_Core"),
b5   = as.integer(unit_id == "Treated_Band_5km"),
b10  = as.integer(unit_id == "Treated_Band_10km"),
b15  = as.integer(unit_id == "Treated_Band_15km"),
b20  = as.integer(unit_id == "Treated_Band_20km"),
band = case_when(
core == 1 ~ "Treated_Core",
b5   == 1 ~ "Treated_Band_5km",
b10  == 1 ~ "Treated_Band_10km",
b15  == 1 ~ "Treated_Band_15km",
b20  == 1 ~ "Treated_Band_20km",
TRUE      ~ "Control"
)
)
# ------------------------------------------------------------
# 2) 밴드별 event-study DiD (TWFE)
#    - ref=-1 (처치 직전 연도=2012)
# ------------------------------------------------------------
m_es <- feols(
outcome ~
i(rel_time, core, ref = -1) +
i(rel_time, b5,   ref = -1) +
i(rel_time, b10,  ref = -1) +
i(rel_time, b15,  ref = -1) +
i(rel_time, b20,  ref = -1)
| unit_id + year,
data = did_df,
vcov = ~ unit_id   # 유닛 클러스터 (유닛 수 적으면 해석은 보수적으로)
)
etable(m_es)
# ------------------------------------------------------------
# 3) plot용 계수 추출/정리
# ------------------------------------------------------------
tid <- broom::tidy(m_es, conf.int = TRUE)
es_df <- tid %>%
filter(grepl("^rel_time::", term)) %>%
mutate(
rel_time = as.integer(sub("^rel_time::(-?[0-9]+):.*$", "\\1", term)),
band = case_when(
grepl(":core$", term) ~ "Treated_Core",
grepl(":b5$",   term) ~ "Treated_Band_5km",
grepl(":b10$",  term) ~ "Treated_Band_10km",
grepl(":b15$",  term) ~ "Treated_Band_15km",
grepl(":b20$",  term) ~ "Treated_Band_20km",
TRUE ~ NA_character_
),
year = TREAT_YEAR + rel_time
) %>%
filter(!is.na(band)) %>%
mutate(band = factor(band, levels = treated_cols))  # Core 왼쪽부터
# ------------------------------------------------------------
# 4) 그림 (너 p_fig5 스타일 최대한 맞춤)
# ------------------------------------------------------------
COL_DID <- "#0072B2"  # 임의(원하면 너 컬러로 바꿔)
p_did_es <- es_df %>%
ggplot(aes(x = year, y = estimate)) +
theme(aspect_ratio = 0.2) +
scale_x_continuous(breaks = c(1997, 2007, 2013)) +
geom_hline(yintercept = 0, linewidth = 0.6) +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high), fill = COL_DID, alpha = 0.25) +
geom_line(color = COL_DID, linewidth = 1.1) +
geom_vline(xintercept = c(2007, 2013), linewidth = 0.7) +
facet_wrap(~ band, nrow = 1, scales = "free_y") +
labs(x = "Years", y = "DiD Event-study (ref = -1)") +
theme_bw(base_size = 20) +
theme(panel.grid.minor = element_blank())
p_did_es
ggsave("did_event_study.png", p_did_es, width = 14, height = 3.6, dpi = 500)
library(dplyr)
library(tidyr)
library(ggplot2)
library(fixest)
library(broom)
# ------------------------------------------------------------
# 0) sim 불러오기
# ------------------------------------------------------------
sim_df <- read.csv("sim.csv", check.names = FALSE)
rownames(sim_df) <- sim_df[[1]]
sim_df[[1]] <- NULL
years <- as.integer(sub("^Y", "", rownames(sim_df)))
# treated 5개(컬럼명 고정)
treated_cols <- c("Treated_Core",
"Treated_Band_5km", "Treated_Band_10km",
"Treated_Band_15km", "Treated_Band_20km")
stopifnot(all(treated_cols %in% colnames(sim_df)))
TREAT_YEAR <- 2013
# ------------------------------------------------------------
# 1) long panel 만들기
# ------------------------------------------------------------
did_df <- sim_df %>%
mutate(year = years) %>%
pivot_longer(-year, names_to = "unit_id", values_to = "outcome") %>%
mutate(
rel_time = year - TREAT_YEAR,
core = as.integer(unit_id == "Treated_Core"),
b5   = as.integer(unit_id == "Treated_Band_5km"),
b10  = as.integer(unit_id == "Treated_Band_10km"),
b15  = as.integer(unit_id == "Treated_Band_15km"),
b20  = as.integer(unit_id == "Treated_Band_20km"),
band = case_when(
core == 1 ~ "Treated_Core",
b5   == 1 ~ "Treated_Band_5km",
b10  == 1 ~ "Treated_Band_10km",
b15  == 1 ~ "Treated_Band_15km",
b20  == 1 ~ "Treated_Band_20km",
TRUE      ~ "Control"
)
)
# ------------------------------------------------------------
# 2) 밴드별 event-study DiD (TWFE)
#    - ref=-1 (처치 직전 연도=2012)
# ------------------------------------------------------------
m_es <- feols(
outcome ~
i(rel_time, core, ref = -1) +
i(rel_time, b5,   ref = -1) +
i(rel_time, b10,  ref = -1) +
i(rel_time, b15,  ref = -1) +
i(rel_time, b20,  ref = -1)
| unit_id + year,
data = did_df,
vcov = ~ unit_id   # 유닛 클러스터 (유닛 수 적으면 해석은 보수적으로)
)
etable(m_es)
# ------------------------------------------------------------
# 3) plot용 계수 추출/정리
# ------------------------------------------------------------
tid <- broom::tidy(m_es, conf.int = TRUE)
es_df <- tid %>%
filter(grepl("^rel_time::", term)) %>%
mutate(
rel_time = as.integer(sub("^rel_time::(-?[0-9]+):.*$", "\\1", term)),
band = case_when(
grepl(":core$", term) ~ "Treated_Core",
grepl(":b5$",   term) ~ "Treated_Band_5km",
grepl(":b10$",  term) ~ "Treated_Band_10km",
grepl(":b15$",  term) ~ "Treated_Band_15km",
grepl(":b20$",  term) ~ "Treated_Band_20km",
TRUE ~ NA_character_
),
year = TREAT_YEAR + rel_time
) %>%
filter(!is.na(band)) %>%
mutate(band = factor(band, levels = treated_cols))  # Core 왼쪽부터
# ------------------------------------------------------------
# 4) 그림 (너 p_fig5 스타일 최대한 맞춤)
# ------------------------------------------------------------
COL_DID <- "#0072B2"  # 임의(원하면 너 컬러로 바꿔)
p_did_es <- es_df %>%
ggplot(aes(x = year, y = estimate)) +
theme(aspect_ratio = 0.2) +
scale_x_continuous(breaks = c(1997, 2007, 2013)) +
geom_hline(yintercept = 0, linewidth = 0.6) +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high), fill = COL_DID, alpha = 0.25) +
geom_line(color = COL_DID, linewidth = 1.1) +
geom_vline(xintercept = c(2007, 2013), linewidth = 0.7) +
facet_wrap(~ band, nrow = 1, scales = "free_y") +
labs(x = "Years", y = "DiD Event-study (ref = -1)") +
theme_bw(base_size = 14) +
theme(panel.grid.minor = element_blank())
p_did_es
ggsave("did_event_study.png", p_did_es, width = 14, height = 3.6, dpi = 500)
